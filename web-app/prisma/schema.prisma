generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model ProcessingJob {
  id               String            @id @default(uuid())
  imagePath        String
  status           String
  createdAt        DateTime          @default(now())
  completedAt      DateTime?
  fileId           String?
  originalName     String?
  extractionResult ExtractionResult?
  ocrResult        OcrResult?
  trainingData     TrainingData?

  @@map("processing_jobs")
}

model OcrResult {
  id               String        @id @default(uuid())
  jobId            String        @unique
  fullText         String?
  textLines        String
  confidence       Float?
  detectedLanguage String?
  processingTime   Int?
  job              ProcessingJob @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@map("ocr_results")
}

model ExtractionResult {
  id                     String        @id @default(uuid())
  jobId                  String        @unique
  extractedData          String
  confidence             Float?
  needsVerification      Boolean       @default(false)
  isVerified             Boolean       @default(false)
  verifiedAt             DateTime?
  verifiedData           String?
  documentType           String?
  documentTypeConfidence Float?
  documentTypeReason     String?
  receiptScore           Float?
  invoiceScore           Float?
  dueDate                DateTime?
  paymentTerms           String?
  billToName             String?
  billToAddress          String?
  billingAddress         String?
  transactionId          String?
  customerCopy           Boolean       @default(false)
  job                    ProcessingJob @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@map("extraction_results")
}

model TrainingData {
  id            String        @id @default(uuid())
  jobId         String        @unique
  rawData       String?
  verifiedData  String?
  features      String?
  labels        String?
  isGroundTruth Boolean       @default(false)
  createdAt     DateTime      @default(now())
  job           ProcessingJob @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@map("training_data")
}
